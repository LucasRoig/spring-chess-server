(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{169:function(e,t,n){},199:function(e,t,n){"use strict";n.r(t);var a=n(164),o=n.n(a),r=n(167),s=n(26),i=n(27),c=n(29),l=n(28),u=n(30),m=n(0),d=n.n(m),h=n(102),p=n(129),v=n.n(p),f=function(){function e(){Object(s.a)(this,e),this.lines=[],this.color=null}return Object(i.a)(e,[{key:"createTraining",value:function(e,t){this.lines=[],this.color=t;var n=v.a.cloneDeep(e);return this.parseLine(n.startingPosition),this.lines}},{key:"parseLine",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=e;n;){if(t.push(n),n.sublines.length>0&&n.sideToMove()!==this.color){var a=!0,o=!1,r=void 0;try{for(var s,i=n.sublines[Symbol.iterator]();!(a=(s=i.next()).done);a=!0){var c=s.value;this.parseLine(v.a.cloneDeep(c),v.a.cloneDeep(t))}}catch(u){o=!0,r=u}finally{try{a||null==i.return||i.return()}finally{if(o)throw r}}}n=n.nextPosition}for(var l=0;l<t.length-1;l++)t[l].nextPosition=t[l+1],t[l].sublines=[],t[l+1].previousPosition=t[l],t[l+1].sublines=[];this.lines.push(t)}}]),e}(),b=n(87),g=n(140),E=n(109),x=n.n(E),w=n(94),P=(n(169),n(98)),N=n(3),y=n(124);n.d(t,"default",function(){return C});var k=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(l.a)(t).call(this,e))).handleStart=function(){n.close(),n.props.onStart(n.state)},n.handleCancel=function(){n.close(),n.props.history.length>0?n.props.history.goBack():n.props.history.push(N.a)},n.handleColorChanged=function(e){var t=e.target.value,a=n.buildTraining(t);n.setState({color:t,lines:a})},n.buildTraining=function(e){return(new f).createTraining(n.props.game,e)},n.state={color:b.a,showDemo:!0,restartAfterError:!0,lines:n.buildTraining(b.a)},n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return d.a.createElement("div",{className:"modal is-active"},d.a.createElement("div",{className:"modal-background"}),d.a.createElement("div",{className:"modal-card"},d.a.createElement("header",{className:"modal-card-head"},d.a.createElement("p",{className:"modal-card-title"},"Configuration de l'entra\xeenement")),d.a.createElement("section",{className:"modal-card-body"},d.a.createElement("h1",{className:"title"},this.props.game.whiteName+(this.props.game.blackName?" - "+this.props.game.blackName:"")),d.a.createElement("h2",{className:"subtitle"},"Nombre de lignes : ",this.state.lines.length),d.a.createElement("div",{className:"field"},d.a.createElement("label",{className:"label"},"Couleur du joueur"),d.a.createElement("div",{className:"control"},d.a.createElement("div",{className:"select is-fullwidth"},d.a.createElement("select",{value:this.state.color,onChange:this.handleColorChanged},d.a.createElement("option",{value:b.b},"Blanc"),d.a.createElement("option",{value:b.a},"Noir"))))),d.a.createElement("div",{className:"field"},d.a.createElement("div",{className:"control"},d.a.createElement("label",{className:"checkbox"},d.a.createElement("input",{type:"checkbox",checked:this.state.showDemo,onChange:function(t){return e.setState({showDemo:t.target.checked})}}),"    Montrer la ligne en premier"))),d.a.createElement("div",{className:"field"},d.a.createElement("div",{className:"control"},d.a.createElement("label",{className:"checkbox"},d.a.createElement("input",{type:"checkbox",checked:this.state.restartAfterError,onChange:function(t){return e.setState({restartAfterError:t.target.checked})}}),"    Recommencer apr\xe8s une erreur")))),d.a.createElement("footer",{className:"modal-card-foot space-between"},d.a.createElement("button",{className:"button",onClick:this.handleCancel},"Annuler"),d.a.createElement("button",{className:"button is-success",onClick:this.handleStart},"D\xe9marrer"))))}}]),t}(P.a),L=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).handleGoBack=function(){n.close(),n.props.history.length>0?n.props.history.goBack():n.props.history.push(N.a)},n.handleRestart=function(){n.close(),n.props.onRestart()},n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return d.a.createElement("div",{className:"modal is-active"},d.a.createElement("div",{className:"modal-background"}),d.a.createElement("div",{className:"modal-card"},d.a.createElement("header",{className:"modal-card-head"},d.a.createElement("p",{className:"modal-card-title"},"Entra\xeenement termin\xe9")),d.a.createElement("section",{className:"modal-card-body"},"L'entra\xeenement est termin\xe9. Vous pouvez recommencer ou retourner \xe0 la page pr\xe9c\xe9dente."),d.a.createElement("footer",{className:"modal-card-foot space-between"},d.a.createElement("button",{className:"button",onClick:this.handleGoBack},"Retour"),d.a.createElement("button",{className:"button is-success",onClick:this.handleRestart},"Recommencer"))))}}]),t}(P.a),C=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(l.a)(t).call(this,e))).showDemo=function(){var e=Object(r.a)(o.a.mark(function e(t){var a,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=function(e){return new Promise(function(t){return setTimeout(t,e)})},r=t[0];case 2:if(!r){e.next=10;break}return n.setState({currentPosition:r}),r.previousPosition&&n.addPositionToNotation(r),e.next=7,a(n.state.demoDelay);case 7:r=r.nextPosition,e.next=2;break;case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.startLine=Object(r.a)(o.a.mark(function e(){var t,a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n.state.errorDuringLine&&n.state.restartAfterError?n.setState({currentPosition:n.state.currentLine[0],game:new w.a,errorDuringLine:!1},n.gameLoop):n.nextLineIndex<n.lines.length?(t=n.lines[n.nextLineIndex],n.nextLineIndex++,n.setState({currentPosition:t[0],currentLine:t,currentLineIndex:n.nextLineIndex,game:new w.a,errorDuringLine:!1},Object(r.a)(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n.state.showDemo?n.setState({demoRunning:!0},Object(r.a)(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.showDemo(t);case 2:n.setState({currentPosition:t[0],game:new w.a,demoRunning:!1},n.gameLoop);case 3:case"end":return e.stop()}},e)}))):n.gameLoop();case 1:case"end":return e.stop()}},e)})))):(a=function(){n.nextLineIndex=0,n.setState({currentLineIndex:1},n.startLine)},Object(P.b)(d.a.createElement(L,{history:n.props.history,onRestart:a})));case 1:case"end":return e.stop()}},e)})),n.gameLoop=function(){var e=n.state.currentPosition;e.nextPosition?e.sideToMove()!==n.state.playerColor&&setTimeout(function(){n.setState({currentPosition:e.nextPosition}),n.addPositionToNotation(e.nextPosition),(e=n.state.currentPosition).nextPosition||setTimeout(n.startLine,1e3)},300):setTimeout(n.startLine,1e3)},n.addPositionToNotation=function(e){for(var t=n.state.game.startingPosition;t.nextPosition;)t=t.nextPosition;var a=v.a.cloneDeep(e);t.nextPosition=a,a.previousPosition=t,a.nextPosition=null,n.setState({game:n.state.game})},n.onMove=function(e,t){var a=n.state.currentPosition;n.chess.load(a.fen);var o=n.chess.move({from:e,to:t,promotion:"q"});o||console.error("Error illegal move"),a.nextPosition||console.error("Error no next position"),n.chess.load(a.fen),n.chess.move(a.nextPosition.lastMove.san,{sloppy:!0}).san!==o.san?(console.log("expected move : "+a.nextPosition.lastMove.san,"user move : "+o.san),n.flashBoard(!1),n.setState({errorDuringLine:!0})):(n.setState({currentPosition:a.nextPosition}),n.flashBoard(!0),n.addPositionToNotation(a.nextPosition),n.gameLoop())},n.flashBoard=function(e){var t=e?"rightMove":"wrongMove";n.setState({boardClass:t}),setTimeout(function(){return n.setState({boardClass:""})},500)},n.showMove=function(){n.state.currentPosition.nextPosition&&!n.state.demoRunning&&(alert(n.state.currentPosition.nextPosition.lastMove.san),n.setState({errorDuringLine:!0}))},n.state={gameToTrain:null,currentPosition:null,currentLine:null,playerColor:b.a,game:new w.a,totalLineCount:0,currentLineIndex:1,boardClass:"",demoRunning:!1,errorDuringLine:!1,showDemo:!0,demoDelay:800,restartAfterError:!0,legalMoves:{}},n.chess=new x.a,n.lines=[],n.nextLineIndex=0,n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params.id;h.a.fetchGame(t).then(function(t){Object(P.b)(d.a.createElement(k,{onStart:function(t){e.lines=t.lines,e.setState({playerColor:t.color,totalLineCount:e.lines.length,showDemo:t.showDemo,restartAfterError:t.restartAfterError},e.startLine)},game:t,history:e.props.history}))})}},{key:"componentDidUpdate",value:function(e,t,n){this.state.currentPosition!==t.currentPosition&&this.calcLegalMoves()}},{key:"calcLegalMoves",value:function(){if(this.state.currentPosition&&this.state.currentPosition.fen){var e={get:function(t){return e[t]}},t=new x.a;t.load(this.state.currentPosition.fen),t.SQUARES.forEach(function(n){var a=t.moves({square:n,verbose:!0});a.length>0&&(e[n]=a.map(function(e){return e.to}))}),this.setState({legalMoves:e})}}},{key:"render",value:function(){return d.a.createElement(d.a.Fragment,null,this.state.currentPosition?d.a.createElement("div",{className:"training-view",onKeyDown:this.onKeyDown},d.a.createElement("div",{className:"game-column"},d.a.createElement(y.a,{className:this.state.boardClass,orientation:this.state.playerColor===b.b?"white":"black",movableColor:this.state.playerColor===b.b?"white":"black",onMove:this.onMove,legalMoves:this.state.legalMoves,viewOnly:this.state.demoRunning,position:this.state.currentPosition.fen}),d.a.createElement("button",{className:"button",onClick:this.showMove},"Show Move")),d.a.createElement("div",{className:"notation-column"},d.a.createElement("div",null,"Ligne ",this.state.currentLineIndex," / ",this.state.totalLineCount),d.a.createElement(g.a,{game:this.state.game,handleClick:this.setPosition,currentPosition:this.state.currentPosition,makeMove:this.makeMove,onContextualAction:this.handleContextualActionOnNotation}))):d.a.createElement("div",null,"loading"))}}]),t}(d.a.Component)},98:function(e,t,n){"use strict";n.d(t,"a",function(){return l}),n.d(t,"b",function(){return m});var a=n(26),o=n(29),r=n(28),s=n(30),i=n(0),c=n(16),l=function(e){function t(){var e,n;Object(a.a)(this,t);for(var s=arguments.length,i=new Array(s),l=0;l<s;l++)i[l]=arguments[l];return(n=Object(o.a)(this,(e=Object(r.a)(t)).call.apply(e,[this].concat(i)))).close=function(){!function(){var e=document.getElementById(u);e&&(Object(c.unmountComponentAtNode)(e),e.parentNode.removeChild(e))}()},n}return Object(s.a)(t,e),t}(i.Component),u="modal-window";function m(e){!function(e){var t=document.getElementById(u);t||((t=document.createElement("div")).id=u,document.body.appendChild(t)),Object(c.render)(e,t)}(e)}}}]);
//# sourceMappingURL=9.558236c9.chunk.js.map