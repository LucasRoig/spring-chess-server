(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{143:function(t,e,n){},194:function(t,e,n){"use strict";n.r(e),n.d(e,"default",function(){return g});var o=n(26),i=n(27),s=n(29),a=n(28),r=n(30),c=n(0),u=n.n(c),l=n(140),v=n(93),P=n(109),m=n.n(P),f=n(94),d=(n(143),n(102)),h=n(124),g=function(t){function e(t){var n;if(Object(o.a)(this,e),(n=Object(s.a)(this,Object(a.a)(e).call(this,t))).chess=new m.a,n.render=function(){return u.a.createElement(u.a.Fragment,null,n.state.game?u.a.createElement("div",{className:"game-view",onKeyDown:n.onKeyDown,tabIndex:"0"},u.a.createElement("div",{className:"game-column"},u.a.createElement("div",{onWheel:n.onWheel},u.a.createElement(h.a,{onMove:n.onMove,legalMoves:n.state.legalMoves,position:n.state.currentPosition.fen})),u.a.createElement("button",{onClick:n.previousPosition},"Previous"),u.a.createElement("button",{onClick:n.nextPosition},"Next"),u.a.createElement("textarea",{value:n.state.currentPosition.comment,onChange:n.saveComment}),u.a.createElement("button",{onClick:n.saveComment},"Save Comment")),u.a.createElement("div",{className:"notation-column"},u.a.createElement(l.a,{game:n.state.game,handleClick:n.setPosition,currentPosition:n.state.currentPosition,makeMove:n.makeMove,onContextualAction:n.handleContextualActionOnNotation}))):u.a.createElement("div",null,"loading"))},n.onWheel=function(t){t.deltaY<0?n.previousPosition():t.deltaY>0&&n.nextPosition()},n.onKeyDown=function(t){return 37===t.keyCode?(n.previousPosition(),void t.preventDefault()):39===t.keyCode?(n.nextPosition(),void t.preventDefault()):void console.log(t.keyCode)},n.saveComment=function(t){var e=n.findPositionInGame(n.state.currentPosition);e&&(e.comment=t.target.value,n.setState({currentPosition:e}))},n.setPosition=function(t){t&&n.setState({currentPosition:t})},n.previousPosition=function(){n.state.currentPosition.previousPosition&&n.setState({currentPosition:n.state.currentPosition.previousPosition})},n.nextPosition=function(){n.state.currentPosition.nextPosition&&n.setState({currentPosition:n.state.currentPosition.nextPosition})},n.isMoveLegal=function(t,e){return n.chess.load(n.state.currentPosition.fen),null!==n.chess.move({from:t,to:e,promotion:"q"})},n.onMove=function(t,e){if(n.isMoveLegal(t,e)){n.chess.load(n.state.currentPosition.fen);var o=n.chess.move({from:t,to:e,promotion:"q"}),i=n.chess.fen();if(n.state.currentPosition.nextPosition&&n.state.currentPosition.nextPosition.fen===i)n.setState({currentPosition:n.state.currentPosition.nextPosition});else{var s=n.state.currentPosition.sublines.filter(function(t){return t.fen===i});if(s.length>0)n.setState({currentPosition:s[0]});else{var a=new v.a(n.chess.fen(),o,n.state.currentPosition);n.state.currentPosition.addNextPosition(a),n.setState({currentPosition:a}),n.saveGame()}}}},n.saveGame=function(){d.a.saveGame(n.state.game)},n.handleContextualActionOnNotation=function(t,e,o){var i=e.action,s=e.position;if("DELETE_NEXT_POSITIONS"===i){var a=n.findPositionInGame(s);if(a)return a.nextPosition=null,a.sublines=[],n.setState({currentPosition:a}),void n.saveGame()}if("PROMOTE_SUBLINE"===i||"DELETE_SUBLINE"===i){var r=n.findPositionInGame(s);if(r){for(var c=r.previousPosition;c;){if(c.nextPosition!==r){var u=c.sublines.indexOf(r);if("PROMOTE_SUBLINE"===i)return c.sublines[u]=c.nextPosition,c.nextPosition=r,void n.setState({currentPosition:s});if("DELETE_SUBLINE"===i)return c.sublines.splice(u,1),n.setState({currentPosition:c}),void console.log(n.state.game)}c=(r=c).previousPosition}n.saveGame()}}console.log(t,e,o)},t.match.params.id)n.state={currentPosition:null,game:null,legalMoves:{}};else{var i=new f.a;n.state={game:i,currentPosition:n.game.startingPosition,legalMoves:{}}}return n.calcLegalMoves(),n}return Object(r.a)(e,t),Object(i.a)(e,[{key:"componentDidUpdate",value:function(t,e,n){this.state.currentPosition!==e.currentPosition&&this.calcLegalMoves()}},{key:"componentDidMount",value:function(){var t=this,e=this.props.match.params.id;e?d.a.fetchGame(e).then(function(e){t.setState({game:e,currentPosition:e.startingPosition})}):this.calcLegalMoves()}},{key:"calcLegalMoves",value:function(){if(this.state.currentPosition&&this.state.currentPosition.fen){var t={get:function(e){return t[e]}},e=new m.a;e.load(this.state.currentPosition.fen),e.SQUARES.forEach(function(n){var o=e.moves({square:n,verbose:!0});o.length>0&&(t[n]=o.map(function(t){return t.to}))}),this.setState({legalMoves:t})}}},{key:"findPositionInGame",value:function(t){for(var e=[this.state.game.startingPosition];e.length>0;){var n=e.pop();if(null!=n&&(e.push(n.nextPosition),n.sublines.forEach(function(t){return e.push(t)}),n===t))return n}return null}}]),e}(c.Component)}}]);
//# sourceMappingURL=10.5f2516dc.chunk.js.map